<html>
    <head>
        <title>Ultimate Game Sheet!</title>
        <link rel="icon" href="images/favicon.ico">
        <!--<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Barlow">-->
        <!-- Firebase SDKs -->
        <script type="module">
            import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
            import { getAuth, setPersistence, browserLocalPersistence } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
            import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

            // Your web app's Firebase configuration
            const firebaseConfig = {
            apiKey: "AIzaSyBfXCbE_NPMOspsbM1LCzOBQHFW-97EKKc",
            authDomain: "gamesheet-history.firebaseapp.com",
            projectId: "gamesheet-history",
            storageBucket: "gamesheet-history.firebasestorage.app",
            messagingSenderId: "929226529796",
            appId: "1:929226529796:web:c4cd1eb9ddcf94c6b76951"
            };
            
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            window.firebaseAuth = getAuth(app);
            
            // Set authentication to never expire - user stays logged in until they explicitly sign out
            setPersistence(window.firebaseAuth, browserLocalPersistence);
            
            window.firebaseDb = getFirestore(app);
        </script>
        <script src="jscolor-modx3.js"></script>
        <script type="module" src="firebase-auth.js"></script>
        <script src="index.js"></script>
        <link rel="stylesheet" href="index.css">
        <link rel="stylesheet" href="indexLight.css">

        <script>
            // These options apply to all color pickers on the page
            jscolor.presets.default = {
                previewSize:0,
                backgroundColor:'rgba(55,55,55,1)', borderColor:'rgba(0,0,0,1)', 
                width:150, height:150, controlBorderColor:'rgba(0,0,0,0)', 
                shadowColor:'rgba(0,0,0,0.51)',
                paletteCols:4,
                palette: [
                    '#9C0000', '#BD3939', '#DC7633', '#BA4A00',
                    '#1ABC9C', '#00CF48', '#D6D904', '#B7950B',
                    '#0E590E', '#0d69bf', '#1A3DB0', '#AF7AC5',
                    '#171717', '#5D6D7E', '#FF0099', '#6C3483'
                ],
                mode: 'HVS',
                format:'hex',
                closeButton:true,
                closeText:'Delete Player',
                buttonColor:'#ffffff', 
	            buttonHeight:90,
                hideOnPaletteClick:true
            };
        </script>
    </head>
	<body onload="createTable()">
        <!-- Firebase Auth UI -->
        <div id="authContainer">
            <div class="auth-modal-content">
                <h2>Sign In to Save Game History</h2>
                
                <!-- Email/Password Auth (shown by default) -->
                <div id="emailAuthForm">
                    <button type="button" id="signInGoogle" onclick="signInWithGoogle()" class="auth-button" style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <svg xmlns="https://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 40 48" aria-hidden="true" jsname="jjf7Ff"><path fill="#4285F4" d="M39.2 24.45c0-1.55-.16-3.04-.43-4.45H20v8h10.73c-.45 2.53-1.86 4.68-4 6.11v5.05h6.5c3.78-3.48 5.97-8.62 5.97-14.71z"></path><path fill="#34A853" d="M20 44c5.4 0 9.92-1.79 13.24-4.84l-6.5-5.05C24.95 35.3 22.67 36 20 36c-5.19 0-9.59-3.51-11.15-8.23h-6.7v5.2C5.43 39.51 12.18 44 20 44z"></path><path fill="#FABB05" d="M8.85 27.77c-.4-1.19-.62-2.46-.62-3.77s.22-2.58.62-3.77v-5.2h-6.7C.78 17.73 0 20.77 0 24s.78 6.27 2.14 8.97l6.71-5.2z"></path><path fill="#E94235" d="M20 12c2.93 0 5.55 1.01 7.62 2.98l5.76-5.76C29.92 5.98 25.39 4 20 4 12.18 4 5.43 8.49 2.14 15.03l6.7 5.2C10.41 15.51 14.81 12 20 12z"></path></svg>
                        Sign in with Google
                    </button>

                    <div class="auth-divider">or</div>

                    <input type="email" id="emailInput" placeholder="Email" autocomplete="email" class="auth-input" onkeydown="if(event.key === 'Enter') { signInWithEmail(); }">
                    <input type="password" id="passwordInput" placeholder="Password (min 6 characters)" autocomplete="current-password" class="auth-input" onkeydown="if(event.key === 'Enter') { signInWithEmail(); }">
                    <button type="button" onclick="signInWithEmail()" class="auth-button">Sign In</button>
                    <button type="button" onclick="signUpWithEmail()" class="auth-button">Create Account</button>
                </div>
                
                <button onclick="document.getElementById('authContainer').style.display = 'none'" class="auth-skip-button">Skip for now</button>
                <div id="authStatus"></div>
            </div>
        </div>
        
        <!-- Game History Modal -->
        <div id="gameHistoryModal">
            <div id="gameHistoryModalContent">
                <div class="game-history-header">
                    <div>
                        <h2>Game History</h2>
                        <div id="gameHistoryUserEmail" class="game-history-user-email"></div>
                    </div>
                    <div class="game-history-header-buttons">
                        <button onclick="saveCurrentGameToHistory()" class="game-history-save-button">Save Game</button>
                        <button onclick="signOutUser()" class="game-history-signout-button">Sign Out</button>
                        <button onclick="document.getElementById('gameHistoryModal').style.display = 'none'" class="game-history-close-button">Close</button>
                    </div>
                </div>
                <div id="gameHistoryList"></div>
            </div>
        </div>
        
        <div id="deletePlayer" onclick="deletePlayer();">⊗</div>
        <div id="modalBackdrop" style="display: none;" onclick="hideSortedScoresModal()"></div>
        <div id="sortedScoresModal" style="display: none;"></div>
        <div id="tableContainer">
            <div id="innerTableContainer">
                <table id="mainTable">
                    <thead></thead>
                    <tbody></tbody>
                </table>
                <div id="addColBar" onclick="addPlayer()"><h1 id="plus">+</h1></div>
            </div>
        </div>
        
        <div id="quickActions">
            <div id="top-section">
                <button id="collapseButton" onclick="expandContract()"><img src="images/arrow.png" id="arrow" height="45px" class="expanded"/></button>
            </div>
            <div id="expand-container">
                <div id="expand-contract" class="expanded">
                    <div>
                        <!--<p>Sort</p>-->
                        <button id="SortLowHigh" onclick="sortScores('LowHigh')"><img src="images/sort_low_high.png" height="90px"/></button>
                        <button id="SortHighLow" onclick="sortScores('HighLow')"><img src="images/sort_high_low.png" height="90px"/></button>
                    </div>
                    <div>
                        <button id="ClearScores" onclick="clearSheet();">Clear Scores</button>
                        <button id="ResetSheet" onclick="resetSheetToDefault()">Reset Sheet</button>
                    </div>
                    <div>
                        <input type="text" id="gameNameInput" placeholder="Game Name" class="game-name-input" onchange="updateGameName()">
                        <!-- Sign In Button (shown when not signed in) -->
                        <button id="signInButton" class="gameHistoryButton" onclick="showSignInModal()">Save Game History</button>
                        <!-- Game History UI (shown when signed in) -->
                        <button id="gameHistoryButton" class="gameHistoryButton" onclick="showGameHistory()">Game History</button>
                    </div>
                </div>
            </div>
            <div id="bottom-section">
            </div>
          </div>
        <div id="negativeButton" style="display: none;" onclick="insertNegative()">-</div>
        
        <!-- Quota Warning Message (shown when Firebase quota is exceeded) -->
        <div id="quotaWarning">
            <strong>⚠️ Firebase API Quota Exceeded:</strong> The free tier limit has been reached. Game history saving is temporarily disabled. Try again later.
        </div>
    </body>
</html>